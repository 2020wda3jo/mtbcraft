<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mtbcraft.mapper.RepairMapper">
	
	<!-- 사용자 타입 조회 0:일반 1:정비소 2:관리자 -->
	<select id="getType" parameterType="String" resultType="int">
		SELECT R_TYPE FROM RIDER WHERE R_ID=#{rider} 
	</select>
	
	<!-- 정비소 문의 조회 -->
	<select id="getQNA" parameterType="String" resultType="com.mtbcraft.dto.Qna">
		SELECT * FROM QNA WHERE QA_SHOP=#{shop} ORDER BY QA_TIME DESC
	</select>
	
	<!-- 정비소 신청 조회 -->
	<select id="getRepairApply" parameterType="String" resultType="com.mtbcraft.dto.Repair_Apply">
		SELECT * FROM REPAIR_APPLY WHERE RA_SHOP=#{shop} ORDER BY RA_NUM DESC
	</select>
	
	<!-- 정비소 답변 안한 문의 조회 -->
	<select id="getNoAnserQNA" parameterType="String" resultType="com.mtbcraft.dto.Qna">
		SELECT * FROM QNA WHERE QA_ANSWER IS NULL AND QA_SHOP=#{shop} ORDER BY QA_TIME DESC
	</select>
	
	<!-- 정비소 확인 안한 신청 조회 -->
	<select id="getNoConfirmRepairApply" parameterType="String" resultType="com.mtbcraft.dto.Repair_Apply">
		SELECT * FROM REPAIR_APPLY WHERE RA_CONFIRM=0 AND RA_SHOP=#{shop} ORDER BY RA_NUM DESC
	</select>
	
	<!-- 문의번호로 문의글 조회 -->
	<select id="getDetailQna" parameterType="int" resultType="com.mtbcraft.dto.Qna">
		SELECT * FROM QNA WHERE QA_NUM=#{qa_num}
	</select>
	
	<!-- 신청번호로 신청 조회 -->
	<select id="getDetailRepairApply" parameterType="int" resultType="com.mtbcraft.dto.Repair_Apply">
		SELECT * FROM REPAIR_APPLY WHERE RA_NUM=#{ra_num}
	</select>
	
	<!-- 문의번호로 문의글 답변 -->
	<update id="updateDetailQna" parameterType="com.mtbcraft.dto.Qna">
		UPDATE QNA SET QA_ANSWER=#{qa_answer} WHERE QA_NUM=#{qa_num}
	</update>
	
	<!-- 신청번호로 신청 수락 및 거절 -->
	<update id="updateRepairApply" parameterType="com.mtbcraft.dto.Repair_Apply">
		UPDATE REPAIR_APPLY SET RA_CONFIRM=#{ra_confirm} WHERE RA_NUM=#{ra_num}
	</update>
</mapper>

