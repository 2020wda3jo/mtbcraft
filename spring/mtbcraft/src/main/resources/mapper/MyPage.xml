<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mtbcraft.mapper.MyPageMapper">

	<select id="getRR" parameterType="String" resultType="com.mtbcraft.dto.RidingRecord">
		SELECT * FROM RIDING_RECORD WHERE RR_RIDER=#{rider}
	</select>
	
	<select id="getBadge" parameterType="String" resultType="com.mtbcraft.dto.Badge">
		<![CDATA[
			SELECT * FROM BADGE where BG_NUM IN 
			(select MISSION.M_BADGE 
			from MISSION_COMPLETE, MISSION 
			where MISSION.M_NUM = MISSION_COMPLETE.MC_MISSION and MISSION_COMPLETE.MC_RIDER = #{rider}
			union
			SELECT COMPETITION.COMP_BADGE 
			FROM COMPETITION_STATUS, COMPETITION 
			where CS_CLUB=2 and CS_RANK <=4 and COMPETITION.COMP_NUM=COMPETITION_STATUS.CS_COMP)
		]]>
	</select>
	
	<!-- 사용자 정보 조회 -->
	<select id="getUserInfo" parameterType="String" resultType="com.mtbcraft.dto.Rider">
		select * from
		( select r_id, r_nickname, r_image, r_point, to_char(r_regdate, 'YYYY-MM-DD HH24:MI:SS') r_regdate, nvl(bg_image,'null.jpg') badge
		from rider, badge where r_badge=bg_num(+) and r_nickname=#{nickname} ),
		( select rr_rider, sum(rr_distance) total from riding_record, rider where r_id=rr_rider and r_nickname=#{nickname} group by rr_rider )
		where r_id = rr_rider
	</select>
</mapper>

